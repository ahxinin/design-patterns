# 3.规范与重构

### 1.重构

重构的目的是保持代码质量持续处于一个可控的状态，也是体现经典设计思想、原则、模式、编程规范的一种实现途径。

重构的对象可以分为大规模高层次的重构和小规模低层次的重构：大规模高层次重构包括对代码分层、模块化、解耦、梳理类之间的交互关系、抽象复用组件等等；小规模低层次的重构包括规范命名、注释、修正函数参数过多、消除超大类、提取重复代码等等编程细节问题，主要是针对类、函数级别的重构。

大规模的重构需要一个合适的时机，存在业务痛点或者技术收益远大于投入成本，更重要的是获取业务方、直属上级的支持；获取支持的方式，可以从小规模重构做起，做出一定的成绩比较有说服力。小规模的重构存在一个陷阱，容易低估了影响范围，引发线上bug；首先在态度上需要谨慎对待，同样需要按照项目流程推进，技术方案阶段评估清楚影响范围，深度参与测试过程。

### 2.单元测试

写单元测试的过程本身就是代码 Code Review 和重构的过程，能有效地发现代码中的 bug 和代码设计上的问题。

对单元测试的认知：

- 编写单元测试尽管繁琐，但并不是太耗时；
- 我们可以稍微放低对单元测试代码质量的要求；
- 覆盖率作为衡量单元测试质量的唯一标准是不合理的；
- 单元测试不要依赖被测代码的具体实现逻辑；
- 单元测试框架无法测试，多半是因为代码的可测试性不好。

实现策略：

- 将函数进行拆分，对不可控组件进行隔离，可设计出完备的单元测试用例。