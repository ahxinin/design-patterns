# 2.设计原则

### 1.单一职责

一个类只负责完成一个职责或者功能。不要设计大而全的类，要设计粒度小，功能单一的类。单一职责原则是为了实现代码高内聚、低耦合，提高代码的复用性、可读性和可维护性。

- 不同的业务场景、业务阶段，对职责是否单一的判断会不一样；
- 不宜拆分得过细，破坏系统的内聚性。

### 2.对扩展开放对修改关闭

添加一个新功能，应该是通过在已有代码基础上扩展代码（新增模块、类、方法、属性等），而非修改已有代码的方式来完成。

- 以最小的修改代码的代价来完成新功能的开发；
- 在不同的粒度下，对扩展和修改的定义会不一样。

如何去实现？

要求在写代码时，多一些思考，考虑未来可能有哪些需求变更，如何设计代码结构，事先留好扩展点，以便在未来需求变更的时候，在不改动代码整体结构、做到最小代码改动的情况下，将新的代码灵活地插入到扩展点上。

### 3.里氏替换

里氏替换原则是用来指导，继承关系中子类该如何设计的一个原则。

按照协议设计约定，父类定义了函数的协议，子类可以改变函数内部的实现逻辑，但不能改变函数的协议，包括：函数功能；对输入、输出、异常的约定；

与多态的区别？

多态是面向对象编程的一大特性，是一种代码实现的思路。里氏替换是一种设计原则，用来指导继承关系中子类该如何设计，子类的设计要保证在替换父类的时候，不改变原有程序的逻辑及不破坏原有程序的正确性。

### 4.接口隔离原则

- 在一组接口集合中，如果部分接口只被部分调用者使用，我们就需要将这部分接口隔离出来，单独给这部分调用者使用；
- 在单个接口中，部分调用者只需要函数中的部分功能，我们就需要把函数拆分成粒度更细的多个函数，让调用者只依赖它需要的接口函数；

### 5.业务系统设计

**需求分析：**

以用户用例的方式来进行需求分析，模拟用户如何使用我们的产品，描述用户在一个特定的应用场景里的一个完整的业务操作流程。

例如，积分有效期的用户用例，可以进行如下设计：

- 用户在获取积分的时候，会告知积分的有效期；
- 用户在使用积分的时候，会优先使用快过期的积分；
- 用户在查询积分明细的时候，会显示积分的有效期和状态（是否过期）；
- 用户在查询总可用积分的时候，会排除过期的积分。

通过用户用例的方式，分析完功能需求后，整体业务需求就很清晰了。以积分系统为例：

- 积分赚取和兑换规则；
- 积分消费和兑换规则；
- 积分及其明细查询。

**系统设计：**

1.合理地将功能划分到不同的模块：

在上面的案例中，积分的兑换规则有：抽象到上层的营销系统中、由各个业务系统自行维护、所有功能都放在积分系统中，这样三种模块划分方式；而为了避免业务知识的耦合，让下层系统更加通用，我们不希望下层系统包含太多上层系统的业务信息，所以更倾向于第一种或者第二种划分方式。

积分系统只负责积分的增、减、查询，以及积分明细的记录和查询。

2.设计模块与模块的交互关系

常见的系统交互方式有同步接口调用、利用消息中间件异步调用，前者简单直接，后者的解耦效果更好；另外，上下层系统之间的调用倾向于通过同步接口，同层之间的调用倾向于异步消息调用。

3.设计模块的接口、数据库、业务模型。