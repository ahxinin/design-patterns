# 4.创建型

### 1.单例模式

一个类只允许创建一个对象，那这个类就是一个单例类，这种设计模式就叫作单例设计模式。常用于表示全局唯一类，如配置信息类、连接池类等。

---

### 2.工厂模式

工厂模式的核心思想就是把创建对象和使用对象解藕，由工厂负责对象的创建，而用户只能通过接口来使用对象，这样就可以灵活应对变化的业务需求，方便代码管理、避免代码重复。案例：

> 我们最常用的 Spring 就是一个Bean 工厂，IOC 通过BeanFactory 对 Bean 进行管理；我们使用的日志框架 slf4j 使用了工厂方法模式；JDK 的 Calendar 使用了简单工厂模式……
> 

在创建逻辑比较复杂时，可以考虑使用工厂模式，封装对象的创建过程，动态地根据不同的类型创建不同的对象。常见场景：

- 代码中存在 if-else 分支判断，动态地根据不同的类型创建不同的对象，考虑将 if-else 创建对象的代码剥离出来，放到工厂类中；
- 单个对象的创建过程比较复杂，需要组合其他类的对象，进行各种初始化操作；

工厂模式分为简单工厂、工厂方法和抽象工厂，简单工厂适用于第一种场景，工厂方法适用于第二种场景，抽象工厂较少用到。

---

### 3.建造者模式

当一个类有很多个属性、存在相互依赖关系，而且需要进行参数校验时，使用构造函数和set()方法会显得臃肿，这时候可以考虑使用建造者模式。实现方式：

- 把校验逻辑放置到 Builder 类中，先创建建造者，并且通过 set() 方法设置建造者的变量值，然后在使用 build() 方法真正创建对象之前，做集中的校验，校验通过之后才会创建对象。
- Builder类可以设计为静态内部类，也可以独立出来；

---

### 4.原型模式

如果对象的创建成本比较大，而且同一个类的不同对象之间差别不大时，可以利用对已有对象进行复制的方式来创建新对象。这种基于原型来创建对象的方式叫做原型设计模式。

浅拷贝与深拷贝：

- 浅拷贝只会复制对象中基本类型数据和引用对象的内存地址，不会递归复制引用对象；
- 深拷贝得到的是一份完全独立的对象，因此比浅拷贝更加耗时和内存空间；

如果要拷贝的对象是不可变对象，使用浅拷贝共享对象是没有问题的；但是对于可变对象，浅拷贝得到的对象和原始对象会共享部分数据，可能出现数据被修改的风险，因此不建议使用浅拷贝，复杂情况下可以使用浅拷贝 + 深度拷贝变更的对象的方式。

---